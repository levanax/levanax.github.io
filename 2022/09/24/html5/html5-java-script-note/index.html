<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>html5 &amp; javascript 笔记 | Levan的鱼塘</title><meta name="author" content="Levan"><meta name="description" content="塘主Levan, Levan, xuebiao"><meta name="keywords" content="html5 javascript"><link rel="stylesheet" href="/css/pond.css" media="screen,projection"><link rel="stylesheet" href="/css/materialize.css" media="screen,projection"><link rel="stylesheet" href="/css/main.css" media="screen,projection"><link rel="stylesheet" href="/css/icon.css" media="screen,projection"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Levan的鱼塘" type="application/atom+xml">
</head><script src="/js/jquery-3.2.1.min.js"></script><script src="/js/materialize.min.js"></script><script src="/js/main.js"></script><script src="/js/pond.js"></script><script src="/js/r.js"></script><body><header><nav class="transparent" role="navigation"><div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo">Levan的鱼塘</a><ul class="right hide-on-med-and-down"><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于我</a></li></ul><ul id="nav-mobile" class="side-nav"><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于我</a></li></ul><a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a></div></nav><div class="progress page-progress"><div class="indeterminate"></div></div></header><main class="container"><div class="row"><div class="row"><div class="col s12 m8 l9"><div class="post white"><div class="post-title"><h2><i class="material-icons green-text">note</i>&nbsp;html5 &amp; javascript 笔记</h2></div><div class="row"><div class="post-data"><ul><time datetime="2022-09-24T06:42:46.000Z"><li><i class="tiny material-icons">access_time</i> <span>9/24/2022</span></li></time><li><i class="tiny material-icons">folder</i> <span><a href="/categories/Levan-update/">Levan update</a></span></li><li><i class="tiny material-icons">folder</i> <span><a href="/categories/Levan-update/Web/">Web</a></span></li><li><i class="tiny material-icons">label</i> <span><a href="/tags/html5/">html5</a></span></li><li><i class="tiny material-icons">label</i> <span><a href="/tags/javascript笔记/">javascript笔记</a></span></li></ul></div></div><div id="postContent" class="post-content"><h2 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h2><h3 id="浏览器-user-agent-标识判断"><a href="#浏览器-user-agent-标识判断" class="headerlink" title="浏览器 user-agent 标识判断"></a>浏览器 user-agent 标识判断</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/User-Agent" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/User-Agent</a></p><hr><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTML</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></p><h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--- 不被html5后规范采纳的，仅用于解决Iphone 输入框，弹出数字键盘，却又可以在代码中加入逗号用作格式化 ---&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"test"</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">inputmode</span>=<span class="string">"decimal"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--- html5 新特性，安卓手机 弹出键盘是可以有小数点的 ---&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"test2"</span> <span class="attr">id</span>=<span class="string">"test2"</span> <span class="attr">pattern</span>=<span class="string">"[0-9]*"</span> /&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="form表单内-button-type-submit"><a href="#form表单内-button-type-submit" class="headerlink" title="form表单内 button type=submit"></a>form表单内 button type=submit</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">onclick</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>预期：以上代码结构，我想在 点击 submit button 时，在click login 方法内以ajax方式请求后端<br><em>不能以改结构方式处理，因为form input submit 都与style相关联</em><br>问题：实际结果始终不如预期<br>原因： form表单虽然没有 action 属性，点击 submit同样会触发form 提交方式，action为当前地址栏URL<br>解决：点击submit button 时，使用 e.preventDefault(); 阻止默认的from表单提交方式</p></blockquote><hr><a id="more"></a><h2 id="JavaScript-常用脚本记录"><a href="#JavaScript-常用脚本记录" class="headerlink" title="JavaScript 常用脚本记录"></a>JavaScript 常用脚本记录</h2><h3 id="去掉数字末尾的0"><a href="#去掉数字末尾的0" class="headerlink" title="去掉数字末尾的0"></a>去掉数字末尾的0</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去掉数字末尾的0</span></span><br><span class="line"><span class="string">"0.000100"</span>.match(<span class="regexp">/[-]?\d*(?:\d|[.]\d*[^0])/</span>);</span><br></pre></td></tr></table></figure><h2 id="JavaScript设计模式"><a href="#JavaScript设计模式" class="headerlink" title="JavaScript设计模式"></a>JavaScript设计模式</h2><p>资料：<a href="https://natee.gitbooks.io/javascript-design-patterns/content/chain-of-responsibility-pattern.html" target="_blank" rel="noopener">gitbook书籍资源1</a></p><h2 id="素材库"><a href="#素材库" class="headerlink" title="素材库"></a>素材库</h2><p>图标素材库：<a href="https://www.iconfont.cn" target="_blank" rel="noopener">阿里图标库</a></p><h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'POST'</span>, <span class="string">'http://192.168.7.128:8080/download'</span>);</span><br><span class="line">xhr.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.lengthComputable) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.loaded + <span class="string">' / '</span> + e.total);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.onloadstart = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'start'</span>);</span><br><span class="line">&#125;;</span><br><span class="line">xhr.onloadend = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">&#125;;</span><br><span class="line">xhr.send(&#123;</span><br><span class="line">  form: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    id: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PC 文件下载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">params</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Blob&#125;</span> </span>params.blob</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>params.fileName</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fileDownload</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> uA = <span class="built_in">window</span>.navigator.userAgent</span><br><span class="line">  <span class="keyword">const</span> isIE =</span><br><span class="line">    /msie\s|trident\/|edge\<span class="comment">//i.test(uA) &amp;&amp;</span></span><br><span class="line">    !!(</span><br><span class="line">      <span class="string">'uniqueID'</span> <span class="keyword">in</span> <span class="built_in">document</span> ||</span><br><span class="line">      <span class="string">'documentMode'</span> <span class="keyword">in</span> <span class="built_in">document</span> ||</span><br><span class="line">      <span class="string">'ActiveXObject'</span> <span class="keyword">in</span> <span class="built_in">window</span> ||</span><br><span class="line">      <span class="string">'MSInputMethodContext'</span> <span class="keyword">in</span> <span class="built_in">window</span></span><br><span class="line">    )</span><br><span class="line">  <span class="keyword">const</span> isEdge = uA.indexOf(<span class="string">'Edge'</span>) &gt; <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isIE || isEdge) &#123;</span><br><span class="line">    navigator.msSaveBlob(params.blob, params.fileName)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="built_in">window</span>.URL.createObjectURL(params.blob)</span><br><span class="line">    <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">    link.setAttribute(<span class="string">'style'</span>, <span class="string">'display:none'</span>)</span><br><span class="line">    link.setAttribute(<span class="string">'id'</span>, <span class="string">'download'</span>)</span><br><span class="line">    link.setAttribute(<span class="string">'href'</span>, url)</span><br><span class="line">    link.setAttribute(<span class="string">'download'</span>, params.fileName)</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(link)</span><br><span class="line">    link.click()</span><br><span class="line">    link.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      URL.revokeObjectURL(url)</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'download'</span>).remove()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><p>如跨域在Chrome正常，火狐浏览器提示<br>firefox with reason: CORS header ‘Access-Control-Allow-Origin’ does not match ‘<a href="http://localhost:4200" target="_blank" rel="noopener">http://localhost:4200</a>, *’).<br>则应检查 火狐浏览器是否有安装 cors 相关插件<br>参考链接：firefox with reason: CORS header ‘Access-Control-Allow-Origin’ does not match ‘<a href="http://localhost:4200" target="_blank" rel="noopener">http://localhost:4200</a>, *’).</p><h2 id="IE-站点图标无法切换问题"><a href="#IE-站点图标无法切换问题" class="headerlink" title="IE 站点图标无法切换问题"></a>IE 站点图标无法切换问题</h2><p>参考链接：<a href="https://stackoverflow.com/questions/29404559/how-to-force-ie11-to-request-a-new-favicon" target="_blank" rel="noopener">https://stackoverflow.com/questions/29404559/how-to-force-ie11-to-request-a-new-favicon</a><br>html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> <span class="attr">href</span>=<span class="string">"resources/favicon.ico"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>javascript</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Chrome allows you to simply tweak the HREF of the LINK tag.</span></span><br><span class="line"><span class="comment">// Firefox appears to require that you remove it and readd it.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setFavicon</span>(<span class="params">url</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    removeFavicon();</span><br><span class="line">    <span class="keyword">var</span> link=<span class="built_in">document</span>.createElement(<span class="string">'link'</span>);</span><br><span class="line">    link.type=<span class="string">'image/x-icon'</span>;</span><br><span class="line">    link.rel=<span class="string">'icon'</span>;</span><br><span class="line">    link.href=url;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(link);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.console) <span class="built_in">console</span>.log(<span class="string">"Set FavIcon URL to "</span> + getFavicon().href);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeFavicon</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> links=<span class="built_in">document</span>.getElementsByTagName(<span class="string">'link'</span>);</span><br><span class="line">    <span class="keyword">var</span> head=<span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;links.length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(links[i].getAttribute(<span class="string">'rel'</span>)===<span class="string">'icon'</span>)&#123;</span><br><span class="line">             head.removeChild(links[i])</span><br><span class="line">        &#125;         </span><br><span class="line">    &#125;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JavaScript编码"><a href="#JavaScript编码" class="headerlink" title="JavaScript编码"></a>JavaScript编码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> RESERVED_CHAR_SET =</span><br><span class="line">  <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-.~_'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_normalized_char</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 转ASCII码，跟java， Char temp =  (char)i ; 一样</span></span><br><span class="line">    <span class="keyword">let</span> c = <span class="built_in">String</span>.fromCharCode(i)</span><br><span class="line">    <span class="keyword">if</span> (!b &amp;&amp; c === <span class="string">'/'</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (RESERVED_CHAR_SET.indexOf(c) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      result.set(c, c)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 转16进制</span></span><br><span class="line">      <span class="keyword">let</span> temp = i.toString(<span class="number">16</span>).toUpperCase()</span><br><span class="line">      <span class="comment">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart</span></span><br><span class="line">      result.set(c, <span class="string">'%'</span> + temp.padStart(<span class="number">2</span>, <span class="string">'0'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.encodString = <span class="function"><span class="keyword">function</span>(<span class="params">path, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> length = path.length</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span></span><br><span class="line">  <span class="keyword">let</span> encode_f = get_normalized_char(b)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.charAt(i) === <span class="string">'/'</span> &amp;&amp; !b) &#123;</span><br><span class="line">      result += <span class="string">'/'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> c = encode_f.get(path.charAt(i))</span><br><span class="line">    <span class="keyword">if</span> (!c) &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    result += c</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="获取指定时区时间（中国）"><a href="#获取指定时区时间（中国）" class="headerlink" title="获取指定时区时间（中国）"></a>获取指定时区时间（中国）</h2><h3 id="方案1-兼容IE，chrome"><a href="#方案1-兼容IE，chrome" class="headerlink" title="方案1,兼容IE，chrome"></a>方案1,兼容IE，chrome</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var timezone &#x3D; 8; &#x2F;&#x2F;目标时区时间，东八区</span><br><span class="line">var offset_GMT &#x3D; new Date().getTimezoneOffset(); &#x2F;&#x2F; 本地时间和格林威治的时间差，单位为分钟</span><br><span class="line">var nowDate &#x3D; new Date().getTime(); &#x2F;&#x2F; 本地时间距 1970 年 1 月 1 日午夜（GMT 时间）之间的毫秒数</span><br><span class="line">var targetDate &#x3D; new Date(nowDate + offset_GMT * 60 * 1000 + timezone * 60 * 60 * 1000);</span><br><span class="line">console.log(&quot;东8区现在是：&quot; + targetDate);</span><br></pre></td></tr></table></figure><p>参考链接：<a href="https://blog.csdn.net/u012193330/article/details/79637660" target="_blank" rel="noopener">点这里</a></p><h3 id="方案2，不兼容IE"><a href="#方案2，不兼容IE" class="headerlink" title="方案2，不兼容IE"></a>方案2，不兼容IE</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取北京时间，毫秒数</span></span><br><span class="line"><span class="comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/parse</span></span><br><span class="line"><span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(<span class="string">"en"</span>, &#123;<span class="attr">timeZone</span>: <span class="string">"Asia/Shanghai"</span>, <span class="attr">timeZoneName</span>: <span class="string">'short'</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// e.g.</span></span><br><span class="line"><span class="keyword">var</span> aestTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(<span class="string">"en-US"</span>, &#123;<span class="attr">timeZone</span>: <span class="string">"Australia/Brisbane"</span>&#125;);</span><br><span class="line">aestTime = <span class="keyword">new</span> <span class="built_in">Date</span>(aestTime);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'AEST time: '</span>+aestTime.toLocaleString())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asiaTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(<span class="string">"en-US"</span>, &#123;<span class="attr">timeZone</span>: <span class="string">"Asia/Shanghai"</span>&#125;);</span><br><span class="line">asiaTime = <span class="keyword">new</span> <span class="built_in">Date</span>(asiaTime);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Asia time: '</span>+asiaTime.toLocaleString())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> usaTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(<span class="string">"en-US"</span>, &#123;<span class="attr">timeZone</span>: <span class="string">"America/New_York"</span>&#125;);</span><br><span class="line">usaTime = <span class="keyword">new</span> <span class="built_in">Date</span>(usaTime);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'USA time: '</span>+usaTime.toLocaleString())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indiaTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(<span class="string">"en-US"</span>, &#123;<span class="attr">timeZone</span>: <span class="string">"Asia/Kolkata"</span>&#125;);</span><br><span class="line">indiaTime = <span class="keyword">new</span> <span class="built_in">Date</span>(indiaTime);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'India time: '</span>+indiaTime.toLocaleString())</span><br></pre></td></tr></table></figure><blockquote><p>参考资料：<a href="https://stackoverflow.com/questions/10087819/convert-date-to-another-timezone-in-javascript" target="_blank" rel="noopener">click me</a></p></blockquote><h2 id="http-response"><a href="#http-response" class="headerlink" title="http response"></a>http response</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener">参考资料</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置缓存</span></span><br><span class="line"><span class="attribute">expires</span> <span class="number">1d</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma private;</span><br><span class="line"><span class="attribute">add_header</span> Cache-Control <span class="string">"private,no-cache"</span>;</span><br></pre></td></tr></table></figure><hr><h2 id="谷歌Chrome-浏览器-禁用安全机制"><a href="#谷歌Chrome-浏览器-禁用安全机制" class="headerlink" title="谷歌Chrome 浏览器 禁用安全机制"></a>谷歌Chrome 浏览器 禁用安全机制</h2><p><a href="https://github.com/zhongxia245/blog/issues/28" target="_blank" rel="noopener">click me</a><br>–disable-web-security –user-data-dir</p><h2 id="谷歌浏览器缓存变化情况"><a href="#谷歌浏览器缓存变化情况" class="headerlink" title="谷歌浏览器缓存变化情况"></a>谷歌浏览器缓存变化情况</h2><p><img src="/assets/2019-11/20191105101451.png" alt="20191105101451.png"><br>第一次打开页面时，从服务器下载</p><p><img src="/assets/2019-11/20191105101611.png" alt="20191105101611.png"><br>退出浏览器后（关闭所有标签页），再次打开时，看到 Size列说明是：读取disk cache</p><p><img src="/assets/2019-11/20191105101623.png" alt="20191105101623.png"><br>不关闭浏览器，刷新时，说明 memory cache（因为js文件已经加载进内存</p><p>*prefetch cache，是html5 缓存标签，表示该文件在浏览器空闲时，预先加载该文件</p><hr><h2 id="浏览器使用缓存时，与服务端文件比对的两个关键属性"><a href="#浏览器使用缓存时，与服务端文件比对的两个关键属性" class="headerlink" title="浏览器使用缓存时，与服务端文件比对的两个关键属性"></a>浏览器使用缓存时，与服务端文件比对的两个关键属性</h2><p>last Modify<br>文件一共有两个时间：创建时间 与 最后修改时间(Last modify)<br>复制文件时，只会改变创建时间，最后修改时间不会改变</p><p>E-TAG<br>相当于文件的指纹，如文件未发生变更，E-TAG 不会发生改变</p><hr><h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	String username = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">	String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">	System.out.println(<span class="string">"username: "</span>+ username +<span class="string">"   \n password: "</span>+password);</span><br><span class="line">	</span><br><span class="line">	Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	UserVO user = <span class="keyword">new</span> UserVO(username,password);</span><br><span class="line">	result.put(<span class="string">"user"</span>, user);</span><br><span class="line">	result.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">       response.setContentType(<span class="string">"text/html;charset=gb2312"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Expose-Headers"</span>, <span class="string">"Content-Type,Cversion,test,test1,Test2"</span>);</span><br><span class="line">       </span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Request-Headers"</span>, <span class="string">"Content-Type,Cversion,test,test1,Test2"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"POST,OPTIONS,GET"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Max-Age"</span>, <span class="string">"60"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Cversion"</span>, <span class="string">"cccc"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"test"</span>, <span class="string">"test"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"test1"</span>, <span class="string">"test1"</span>);</span><br><span class="line">       response.setHeader(<span class="string">"Test2"</span>, <span class="string">"test2"</span>);</span><br><span class="line">       </span><br><span class="line">       PrintWriter out = response.getWriter();  </span><br><span class="line">       JSONObject LoginFieldsList = JSONObject.fromObject(result);</span><br><span class="line">       System.out.println(LoginFieldsList.toString());</span><br><span class="line">       out.println(LoginFieldsList);  </span><br><span class="line">       out.flush();  </span><br><span class="line">       out.close(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>服务端需要响应 header参考</p><hr><h2 id="遇到的问题列表"><a href="#遇到的问题列表" class="headerlink" title="遇到的问题列表"></a>遇到的问题列表</h2><h3 id="new-Date-getTime-时间戳"><a href="#new-Date-getTime-时间戳" class="headerlink" title="new Date().getTime() 时间戳"></a>new Date().getTime() 时间戳</h3><blockquote><p>参考资料：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime</a><br>*这个 getTime 获取到的时间戳 ，都是 格林威治时间数值，所以这个数值使用的 格林威治时区的时间，当服务端与客户端交互时，做时间差比对时，不需要转换为服务器端时区时间 来执行 getTime</p></blockquote><!--more --><hr><h3 id="setTimeout-setInterval-定时器问题-amp-注意点"><a href="#setTimeout-setInterval-定时器问题-amp-注意点" class="headerlink" title="setTimeout() setInterval() 定时器问题 &amp; 注意点"></a>setTimeout() setInterval() 定时器问题 &amp; 注意点</h3><p><img src="/assets/2020-3-31/setTimeout-desc.png" alt="setTimeout-desc.png"><br><img src="/assets/2020-3-31/setInterval-desc.png" alt="setInterval-desc.png"></p><hr><h3 id="剪切板-amp-自动打开摄像头"><a href="#剪切板-amp-自动打开摄像头" class="headerlink" title="剪切板 &amp; 自动打开摄像头"></a>剪切板 &amp; 自动打开摄像头</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Clipboard</a><br>Secure context: This feature is available only in secure contexts (HTTPS), in some or all supporting browsers.</p><hr></div></div></div><div id="postToc" class="col m4 l3 post-toc-right hide-on-small-only"><div class="toc-wrapper white"><ol class="pinned-index table-of-contents"><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#HTML5"><span class="pinned-index table-of-contents-number">1.</span> <span class="pinned-index table-of-contents-text">HTML5</span></a><ol class="pinned-index table-of-contents-child"><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#浏览器-user-agent-标识判断"><span class="pinned-index table-of-contents-number">1.1.</span> <span class="pinned-index table-of-contents-text">浏览器 user-agent 标识判断</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#input"><span class="pinned-index table-of-contents-number">1.2.</span> <span class="pinned-index table-of-contents-text">input</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#form表单内-button-type-submit"><span class="pinned-index table-of-contents-number">1.3.</span> <span class="pinned-index table-of-contents-text">form表单内 button type&#x3D;submit</span></a></li></ol></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#JavaScript-常用脚本记录"><span class="pinned-index table-of-contents-number">2.</span> <span class="pinned-index table-of-contents-text">JavaScript 常用脚本记录</span></a><ol class="pinned-index table-of-contents-child"><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#去掉数字末尾的0"><span class="pinned-index table-of-contents-number">2.1.</span> <span class="pinned-index table-of-contents-text">去掉数字末尾的0</span></a></li></ol></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#JavaScript设计模式"><span class="pinned-index table-of-contents-number">3.</span> <span class="pinned-index table-of-contents-text">JavaScript设计模式</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#素材库"><span class="pinned-index table-of-contents-number">4.</span> <span class="pinned-index table-of-contents-text">素材库</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#文件下载"><span class="pinned-index table-of-contents-number">5.</span> <span class="pinned-index table-of-contents-text">文件下载</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#跨域问题"><span class="pinned-index table-of-contents-number">6.</span> <span class="pinned-index table-of-contents-text">跨域问题</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#IE-站点图标无法切换问题"><span class="pinned-index table-of-contents-number">7.</span> <span class="pinned-index table-of-contents-text">IE 站点图标无法切换问题</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#JavaScript编码"><span class="pinned-index table-of-contents-number">8.</span> <span class="pinned-index table-of-contents-text">JavaScript编码</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#获取指定时区时间（中国）"><span class="pinned-index table-of-contents-number">9.</span> <span class="pinned-index table-of-contents-text">获取指定时区时间（中国）</span></a><ol class="pinned-index table-of-contents-child"><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#方案1-兼容IE，chrome"><span class="pinned-index table-of-contents-number">9.1.</span> <span class="pinned-index table-of-contents-text">方案1,兼容IE，chrome</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#方案2，不兼容IE"><span class="pinned-index table-of-contents-number">9.2.</span> <span class="pinned-index table-of-contents-text">方案2，不兼容IE</span></a></li></ol></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#http-response"><span class="pinned-index table-of-contents-number">10.</span> <span class="pinned-index table-of-contents-text">http response</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#谷歌Chrome-浏览器-禁用安全机制"><span class="pinned-index table-of-contents-number">11.</span> <span class="pinned-index table-of-contents-text">谷歌Chrome 浏览器 禁用安全机制</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#谷歌浏览器缓存变化情况"><span class="pinned-index table-of-contents-number">12.</span> <span class="pinned-index table-of-contents-text">谷歌浏览器缓存变化情况</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#浏览器使用缓存时，与服务端文件比对的两个关键属性"><span class="pinned-index table-of-contents-number">13.</span> <span class="pinned-index table-of-contents-text">浏览器使用缓存时，与服务端文件比对的两个关键属性</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#跨域"><span class="pinned-index table-of-contents-number">14.</span> <span class="pinned-index table-of-contents-text">跨域</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-2"><a class="pinned-index table-of-contents-link" href="#遇到的问题列表"><span class="pinned-index table-of-contents-number">15.</span> <span class="pinned-index table-of-contents-text">遇到的问题列表</span></a><ol class="pinned-index table-of-contents-child"><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#new-Date-getTime-时间戳"><span class="pinned-index table-of-contents-number">15.1.</span> <span class="pinned-index table-of-contents-text">new Date().getTime() 时间戳</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#setTimeout-setInterval-定时器问题-amp-注意点"><span class="pinned-index table-of-contents-number">15.2.</span> <span class="pinned-index table-of-contents-text">setTimeout() setInterval() 定时器问题 &amp; 注意点</span></a></li><li class="pinned-index table-of-contents-item pinned-index table-of-contents-level-3"><a class="pinned-index table-of-contents-link" href="#剪切板-amp-自动打开摄像头"><span class="pinned-index table-of-contents-number">15.3.</span> <span class="pinned-index table-of-contents-text">剪切板 &amp; 自动打开摄像头</span></a></li></ol></li></ol></div></div></div><script src="/js/post.js"></script></div></main><footer class="page-footer transparent"><div class="container"><div class="row"><div class="col l6 s12"><h5 class="white-text">Levan的鱼塘</h5><p class="grey-text text-lighten-4">学浅才疏，如有错误，还请指正，多谢 / Thx ！</p><p class="grey-text text-lighten-4">联系我: levanax@126.com</p><p class="grey-text text-lighten-4"><a class="white-text" href="https://github.com/levanax" target="_blank" rel="noopener"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="20px" height="20px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg> </span><span class="username">levanax</span> </a>&nbsp;&nbsp;&nbsp; 订阅 <a class="rss white-text" href="/atom.xml" title="RSS"><i class="material-icons footer-i">rss_feed</i>RSS</a></p></div><div class="col l4 offset-l2 s12"><h5 class="white-text">友链</h5><ul><li><a class="grey-text text-lighten-3" target="_blank" href="http://www.xuebiao.top/">xuebiao</a></li><li><a class="grey-text text-lighten-3" target="_blank" href="https://levanax.github.io/">塘主Levan</a></li></ul></div></div></div><div class="footer-copyright"><div class="container">© 2017 - 2021 Levan <a target="_blank" class="icpCode-a" href="https://beian.miit.gov.cn">粤ICP备17135417号</a></div></div></footer></body></html>